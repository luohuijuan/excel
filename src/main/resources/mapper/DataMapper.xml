<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.excel.mapper.DataMapper">
    <select id="queryDeptList"  resultType="java.util.LinkedHashMap">
        select * from dept
    </select>

    <select id="queryChainList"  resultType="java.util.LinkedHashMap">
        SELECT
            chain.chain_id AS '门店编号',
            chain.chain_name AS '门店名称',
            chain.clerk_name AS '店主名称',
            chain.class_name AS '门店类型',
            chain.address AS '门店地址',
            chain.chain_phone AS '联系电话',
            online_rate.store_sign_discount AS '线上分销',
            offline_rate.store_sign_discount AS '线下分销'
        FROM chain
        LEFT JOIN
        (
            SELECT
                level_marketing_distribution_chain_site.chain_id,
                level_marketing_distribution_chain_site.store_sign_discount
            FROM level_marketing_distribution_chain_site
            WHERE level_marketing_distribution_chain_site.chain_type = 1
        ) AS online_rate
        ON online_rate.chain_id = chain.chain_id
        LEFT JOIN
        (
            SELECT
                level_marketing_distribution_chain_site.chain_id,
                level_marketing_distribution_chain_site.store_sign_discount
            FROM level_marketing_distribution_chain_site
            WHERE level_marketing_distribution_chain_site.chain_type = 2
        ) AS offline_rate
        ON offline_rate.chain_id = chain.chain_id

    </select>
	<select id="data1"  resultType="java.util.LinkedHashMap">
SELECT 
	*
FROM
(
	SELECT
		CONCAT('O2O',
			CASE chain_orders.orders_type
				WHEN 100 THEN '线上'
				WHEN 101 THEN '线下'
				WHEN 102 THEN '线下扫码'
			END
		) AS '订单类型',
		chain_orders.orders_sn AS '订单编号',
		CASE chain_orders.orders_state
			WHEN 0 THEN '订单被取消'
			WHEN 10 THEN '生成新订单'
			WHEN 30 THEN '已支付'
			WHEN 40 THEN '订单完成'
			WHEN 50 THEN '已接单'
			WHEN 60 THEN '已呼叫配送'
			WHEN 70 THEN '待收货'
			WHEN 80 THEN '待评价'
		END AS '订单状态',
		chain.chain_name AS '归属门店名称',
		store.store_name AS '归属店铺名称',
		goods_common.common_id AS '商品id',
		goods_common.goods_name AS '商品名称',
		chain_orders.create_time AS '下单时间',
		chain_orders.orders_amount + chain_orders.points_money_amount + chain_orders.freight_amount AS '订单金额',
		chain_orders.predeposit_amount AS '实付现金',
		chain_orders.points_money_amount AS '美豆抵扣',
		store.store_name AS '店铺名称/自提门店名称',
		chain_orders.receiver_message AS '买家留言',
		member.member_id AS '买家编号',
		member.mobile AS '买家手机号'
	FROM chain_orders
	LEFT JOIN chain_orders_goods ON chain_orders_goods.orders_id = chain_orders.orders_id
	LEFT JOIN goods_common ON goods_common.common_id = chain_orders_goods.common_id
	LEFT JOIN chain ON chain.chain_id = chain_orders.chain_id
	LEFT JOIN store ON store.store_id = chain.store_id
	LEFT JOIN member ON member.member_id = chain_orders.member_id

	UNION ALL

	SELECT
		'B2C' AS '订单类型',
		orders.orders_sn AS '订单编号',
		CASE orders.orders_state
			WHEN 0 THEN '订单被取消'
			WHEN 10 THEN '生成新订单'
			WHEN 30 THEN '已支付'
			WHEN 40 THEN '订单完成'
			WHEN 50 THEN '已接单'
			WHEN 60 THEN '已呼叫配送'
			WHEN 70 THEN '待收货'
			WHEN 80 THEN '待评价'
		END AS '订单状态',
		'' AS '归属门店名称',
		store.store_name AS '归属店铺名称',
		goods_common.common_id AS '商品id',
		goods_common.goods_name AS '商品名称',
		orders.create_time AS '下单时间',
		orders.orders_amount + orders.points_money_amount + orders.freight_amount AS '订单金额',
		orders.predeposit_amount AS '实付现金',
		orders.points_money_amount AS '美豆抵扣',
		store.store_name AS '店铺名称/自提门店名称',
		orders.receiver_message AS '买家留言',
		member.member_id AS '买家编号',
		member.mobile AS '买家手机号'
	FROM orders
	LEFT JOIN orders_goods ON orders_goods.orders_id = orders.orders_id
	LEFT JOIN goods_common ON goods_common.common_id = orders_goods.common_id
	LEFT JOIN store ON store.store_id = orders.store_id
	LEFT JOIN member ON member.member_id = orders.member_id
) AS x
WHERE (x.订单类型 = 'B2C' OR x.订单类型 = 'O2O线上') -- AND x.下单时间 BETWEEN '2020-07-27 00:00:00' AND '2020-07-27 23:59:59'
ORDER BY x.下单时间
	</select>
	<select id="data2"  resultType="java.util.LinkedHashMap">
	</select>
	<select id="data3"  resultType="java.util.LinkedHashMap">
	</select>
	<select id="data4"  resultType="java.util.LinkedHashMap">
	</select>
	<select id="data5"  resultType="java.util.LinkedHashMap">
	</select>
	<select id="data6" parameterType="java.util.Map"  resultType="java.util.LinkedHashMap">
SELECT * FROM
(
SELECT
	chain.chain_id AS '门店编号',
	chain.chain_name AS '门店名称',
	chain.clerk_name AS '店主名称',
	chain.class_name AS '门店类型',
	chain.address AS '门店地址',
	chain.chain_phone AS '联系电话',
	online_rate.store_sign_discount AS '线上分销',
	offline_rate.store_sign_discount AS '线下分销'
FROM chain
LEFT JOIN
(
	SELECT
		level_marketing_distribution_chain_site.chain_id,
		level_marketing_distribution_chain_site.store_sign_discount
	FROM level_marketing_distribution_chain_site
	WHERE level_marketing_distribution_chain_site.chain_type = 1
) AS online_rate
ON online_rate.chain_id = chain.chain_id
LEFT JOIN
(
	SELECT
		level_marketing_distribution_chain_site.chain_id,
		level_marketing_distribution_chain_site.store_sign_discount
	FROM level_marketing_distribution_chain_site
	WHERE level_marketing_distribution_chain_site.chain_type = 2
) AS offline_rate
ON offline_rate.chain_id = chain.chain_id
) AS x
WHERE 1=1
<if test="门店编号 != null and 门店编号 != ''">
AND 门店编号 = #{门店编号}
</if>
<if test="门店名称 != null and 门店名称 != ''">
AND 门店名称 LIKE CONCAT('%',#{门店名称},'%')
</if>
<if test="店主名称 != null and 店主名称 != ''">
AND 店主名称 LIKE CONCAT('%',#{店主名称},'%')
</if>
<if test="门店类型 != null and 门店类型 != ''">
AND 门店类型 LIKE CONCAT('%',#{门店类型},'%')
</if>
<if test="门店地址 != null and 门店地址 != ''">
AND 门店地址 LIKE CONCAT('%',#{门店地址},'%')
</if>
<if test="联系电话 != null and 联系电话 != ''">
AND 联系电话 LIKE CONCAT('%',#{联系电话},'%')
</if>
<if test="线上分销 != null and 线上分销 != ''">
AND 线上分销 = #{线上分销}
</if>
<if test="线下分销 != null and 线下分销 != ''">
AND 线下分销 = #{线下分销}
</if>
<if test="sort != null and sort != '' and order != null and order != ''">
ORDER BY ${sort} ${order}
</if>
	</select>
	<select id="data7"  resultType="java.util.LinkedHashMap">
	</select>
	<select id="data8"  resultType="java.util.LinkedHashMap">
	</select>
	<select id="data9"  resultType="java.util.LinkedHashMap">
	</select>
</mapper>